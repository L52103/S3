<div class="dashboard-container">
  <h1 class="dashboard-title">Panel de Inventario</h1>

  <mat-accordion multi>

    <!-- Personal -->
    <mat-expansion-panel [expanded]="seccionActiva === 'personal'" (opened)="seccionActiva='personal'" (closed)="seccionActiva=null">
      <mat-expansion-panel-header>
        <mat-panel-title>Personal</mat-panel-title>
      </mat-expansion-panel-header>

      <h2>Gestión de Personal</h2>
      <mat-card style="margin-bottom: 20px;">
        <mat-card-title>{{ personalEditandoId ? 'Editar Personal' : 'Agregar Personal' }}</mat-card-title>
        <mat-card-content>
          <mat-form-field appearance="fill" style="display:block; margin-bottom:8px;">
            <mat-label>Nombre</mat-label>
            <input matInput [(ngModel)]="nuevoPersonal.nombre" />
          </mat-form-field>

          <mat-form-field appearance="fill" style="display:block; margin-bottom:8px;">
            <mat-label>Cargo</mat-label>
            <input matInput [(ngModel)]="nuevoPersonal.cargo" />
          </mat-form-field>
        </mat-card-content>
        <mat-card-actions>
          <button *ngIf="personalEditandoId === null" mat-raised-button color="primary" (click)="agregarPersonal()">Agregar</button>
          <button *ngIf="personalEditandoId !== null" mat-raised-button color="accent" (click)="guardarPersonal()">Guardar</button>
          <button *ngIf="personalEditandoId !== null" mat-button (click)="cancelarEdicionPersonal()">Cancelar</button>
        </mat-card-actions>
      </mat-card>

      <mat-divider></mat-divider>

      <mat-list>
        <mat-list-item *ngFor="let p of personal">
          <div style="flex: 1;">
            {{p.nombre}} - {{p.cargo}}
          </div>
          <button mat-button color="primary" (click)="editarPersonal(p)">Editar</button>
          <button mat-button color="warn" (click)="eliminarPersonal(p.id)">Eliminar</button>
        </mat-list-item>
      </mat-list>
    </mat-expansion-panel>

    <!-- Productos -->
    <mat-expansion-panel [expanded]="seccionActiva === 'productos'" (opened)="seccionActiva='productos'" (closed)="seccionActiva=null">
      <mat-expansion-panel-header>
        <mat-panel-title>Productos</mat-panel-title>
      </mat-expansion-panel-header>

      <h2>Gestión de Productos</h2>
      <mat-card style="margin-bottom: 20px;">
        <mat-card-title>{{ productoEditandoId ? 'Editar Producto' : 'Agregar Producto' }}</mat-card-title>
        <mat-card-content>
          <mat-form-field appearance="fill" style="display:block; margin-bottom:8px;">
            <mat-label>Nombre producto</mat-label>
            <input matInput [(ngModel)]="nuevoProducto.nombre" />
          </mat-form-field>

          <mat-form-field appearance="fill" style="display:block; margin-bottom:8px;">
            <mat-label>Stock</mat-label>
            <input matInput type="number" [(ngModel)]="nuevoProducto.stock" />
          </mat-form-field>
        </mat-card-content>
        <mat-card-actions>
          <button *ngIf="productoEditandoId === null" mat-raised-button color="primary" (click)="agregarProducto()">Agregar</button>
          <button *ngIf="productoEditandoId !== null" mat-raised-button color="accent" (click)="guardarProducto()">Guardar</button>
          <button *ngIf="productoEditandoId !== null" mat-button (click)="cancelarEdicionProducto()">Cancelar</button>
        </mat-card-actions>
      </mat-card>

      <mat-divider></mat-divider>

      <mat-list>
        <mat-list-item *ngFor="let p of productos">
          <div style="flex: 1;">
            {{p.nombre}} - Stock: {{p.stock}}
          </div>
          <button mat-button color="primary" (click)="editarProducto(p)">Editar</button>
          <button mat-button color="warn" (click)="eliminarProducto(p.id)">Eliminar</button>
        </mat-list-item>
      </mat-list>
    </mat-expansion-panel>

    <!-- Categorías -->
    <mat-expansion-panel [expanded]="seccionActiva === 'categorias'" (opened)="seccionActiva='categorias'" (closed)="seccionActiva=null">
      <mat-expansion-panel-header>
        <mat-panel-title>Categorías</mat-panel-title>
      </mat-expansion-panel-header>

      <h2>Gestión de Categorías</h2>
      <mat-card style="margin-bottom: 20px;">
        <mat-card-title>{{ categoriaEditandoId ? 'Editar Categoría' : 'Agregar Categoría' }}</mat-card-title>
        <mat-card-content>
          <mat-form-field appearance="fill" style="display:block; margin-bottom:8px;">
            <mat-label>Nombre categoría</mat-label>
            <input matInput [(ngModel)]="nuevaCategoria.nombre" />
          </mat-form-field>

          <mat-form-field appearance="fill" style="display:block; margin-bottom:8px;">
            <mat-label>Descripción</mat-label>
            <input matInput [(ngModel)]="nuevaCategoria.descripcion" />
          </mat-form-field>
        </mat-card-content>
        <mat-card-actions>
          <button *ngIf="categoriaEditandoId === null" mat-raised-button color="primary" (click)="agregarCategoria()">Agregar</button>
          <button *ngIf="categoriaEditandoId !== null" mat-raised-button color="accent" (click)="guardarCategoria()">Guardar</button>
          <button *ngIf="categoriaEditandoId !== null" mat-button (click)="cancelarEdicionCategoria()">Cancelar</button>
        </mat-card-actions>
      </mat-card>

      <mat-divider></mat-divider>

      <mat-list>
        <mat-list-item *ngFor="let c of categorias">
          <div style="flex: 1;">
            {{c.nombre}} - {{c.descripcion}}
          </div>
          <button mat-button color="primary" (click)="editarCategoria(c)">Editar</button>
          <button mat-button color="warn" (click)="eliminarCategoria(c.id)">Eliminar</button>
        </mat-list-item>
      </mat-list>
    </mat-expansion-panel>

    <!-- Ventas -->
    <mat-expansion-panel [expanded]="seccionActiva === 'ventas'" (opened)="seccionActiva='ventas'" (closed)="seccionActiva=null">
      <mat-expansion-panel-header>
        <mat-panel-title>Ventas</mat-panel-title>
      </mat-expansion-panel-header>

      <h2>Registrar Venta</h2>
      <mat-card style="margin-bottom: 20px;">
        <mat-card-content>
          <mat-form-field appearance="fill" style="display:block; margin-bottom:8px;">
            <mat-label>Producto</mat-label>
            <mat-select [(ngModel)]="ventaSeleccion.productoId">
              <mat-option *ngFor="let p of productos" [value]="p.id">
                {{p.nombre}}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="fill" style="display:block; margin-bottom:8px;">
            <mat-label>Cantidad</mat-label>
            <input matInput type="number" [(ngModel)]="ventaSeleccion.cantidad" />
          </mat-form-field>
        </mat-card-content>
        <mat-card-actions>
          <button mat-raised-button color="primary" (click)="registrarVenta()">Registrar</button>
        </mat-card-actions>
      </mat-card>

      <mat-divider></mat-divider>

      <mat-list>
        <mat-list-item *ngFor="let v of ventas">
          Producto: {{ obtenerNombreProducto(v.productoId) }} - Cantidad: {{v.cantidad}}
        </mat-list-item>
      </mat-list>
    </mat-expansion-panel>

    <!-- Compras -->
    <mat-expansion-panel [expanded]="seccionActiva === 'compras'" (opened)="seccionActiva='compras'" (closed)="seccionActiva=null">
      <mat-expansion-panel-header>
        <mat-panel-title>Compras</mat-panel-title>
      </mat-expansion-panel-header>

      <h2>Registrar Compra</h2>
      <mat-card style="margin-bottom: 20px;">
        <mat-card-content>
          <mat-form-field appearance="fill" style="display:block; margin-bottom:8px;">
            <mat-label>Producto</mat-label>
            <mat-select [(ngModel)]="compraSeleccion.productoId">
              <mat-option *ngFor="let p of productos" [value]="p.id">
                {{p.nombre}}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="fill" style="display:block; margin-bottom:8px;">
            <mat-label>Cantidad</mat-label>
            <input matInput type="number" [(ngModel)]="compraSeleccion.cantidad" />
          </mat-form-field>
        </mat-card-content>
        <mat-card-actions>
          <button mat-raised-button color="primary" (click)="registrarCompra()">Registrar</button>
        </mat-card-actions>
      </mat-card>

      <mat-divider></mat-divider>

      <mat-list>
        <mat-list-item *ngFor="let c of compras">
          Producto: {{ obtenerNombreProducto(c.productoId) }} - Cantidad: {{c.cantidad }}
        </mat-list-item>
      </mat-list>
    </mat-expansion-panel>

    <!-- Reportes -->
    <mat-expansion-panel [expanded]="seccionActiva === 'reportes'" (opened)="seccionActiva='reportes'" (closed)="seccionActiva=null">
      <mat-expansion-panel-header>
        <mat-panel-title>Reportes</mat-panel-title>
      </mat-expansion-panel-header>

      <h2>Reporte de Stock</h2>
      <mat-list>
        <mat-list-item *ngFor="let p of productos">
          {{p.nombre}} - Stock actual: {{p.stock}}
        </mat-list-item>
      </mat-list>

      <h2 style="margin-top: 24px;">Resumen de Ventas</h2>
      <mat-list>
        <mat-list-item *ngFor="let v of ventas">
          {{ obtenerNombreProducto(v.productoId) }} - Vendido: {{v.cantidad}}
        </mat-list-item>
      </mat-list>

      <h2 style="margin-top: 24px;">Resumen de Compras</h2>
      <mat-list>
        <mat-list-item *ngFor="let c of compras">
          {{ obtenerNombreProducto(c.productoId) }} - Comprado: {{c.cantidad}}
        </mat-list-item>
      </mat-list>
    </mat-expansion-panel>

  </mat-accordion>

  <div style="text-align: center; margin-top: 32px;">
    <button mat-stroked-button color="primary" (click)="mostrarBaseDeDatos()">
      Ver Base de Datos
    </button>
  </div>
</div>
